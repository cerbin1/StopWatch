<!DOCTYPE html>
<html lang="pl">
<head>
    <title>Countdown</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
</head>
<body>
<div class="container">
    <div id="timer" class="buttons">00:00:00</div>
    <div class="navbar">
        <ul class="countdown-buttons">
            <li id="run-timer" onclick="runTimer()" class="centering-buttons">Start</li>
            <li id="reset" onclick="reset()">Reset</li>
        </ul>
    </div>

    <div class="backButton"><a href="index.html">Back</a></div>
    <label>Minutes<input id="minutes" type="number" value="0"></label>
    <label>Seconds<input id="seconds" type="number" value="0"></label>
    <input class="input-button" type="button" onclick="setCountdown()" value="Set">

</div>
<script>
    var interval;
    var countDownTimeInMillis = 0;
    var running = false;
    var isCountdownSet = false;
    var soundEffect = new Audio('sound/phone_sound_effect.mp3');

    var seconds;
    var minutes;
    var hours;

    var timeToCountDownInMillis;

    var finished = true;

    var timeToCountDown;

    function setCountdown() {
        if (running) {
            console.log("Timer is running");
        } else {
            var secondsValue = parseInt($('#seconds').val(), 10);
            var minutesValue = parseInt($('#minutes').val(), 10);

            timeToCountDownInMillis = (minutesValue * 60 + secondsValue) * 1000;
            console.log(timeToCountDownInMillis);

            seconds = Math.floor(timeToCountDownInMillis / 1000) % 60;
            minutes = Math.floor(timeToCountDownInMillis / 1000 / 60) % 60;
            hours = Math.floor(timeToCountDownInMillis / 1000 / 60 / 60);


            if (isNaN(secondsValue) || isNaN(minutesValue)) {
                console.log("Not a number");
            } else if (seconds < 0 || minutes < 0) {
                console.log("Time can not be negative");
            } else if (seconds === 0 && minutes === 0 && hours === 0) {
                console.log("Timer can not be zero");
            } else {
                $('#timer').text(getTimeToDisplay());
                isCountdownSet = true;
            }
        }
    }

    function getTimeToDisplay() {
        var displaySeconds = ":";
        var displayMinutes = ":";
        var displayHours = "";

        if (seconds < 10) {
            displaySeconds = ":0";
        }
        if (seconds % 60 === 0) {
            displaySeconds = ":0";
        }
        if (minutes < 10) {
            displayMinutes = ":0";
        }
        if (hours < 10) {
            displayHours = "0";
        }
        return displayHours + hours +
            displayMinutes + minutes + displaySeconds + seconds;
    }

    function runTimer() {
        if (finished) {
            if (isCountdownSet) {
                timeToCountDown = new Date().getTime() + timeToCountDownInMillis;
                $('#run-timer').text('Pause');
                startTimer();
                finished = false;
            } else {
                console.log("Set new timer");
            }
        }
        else {
            toggleTimer();
        }
    }

    function toggleTimer() {
        if (running) {
            changeStatusOfTimer();
            clearInterval(interval);
            console.log("Paused");
        } else {
            changeStatusOfTimer();
            startTimer();
            console.log("Unaused");
            console.log(timeToCountDown);
        }
    }

    function changeStatusOfTimer() {
        running = !running;
        $('#run-timer').text(running ? 'Resume' : 'Pause');
    }

    function startTimer() {
        interval = setInterval(function () {
            var test = timeToCountDown - new Date().getTime();
            hours = Math.floor(test / 3600000);
            minutes = Math.floor(test / 60000) % 60;
            seconds = Math.floor(test / 1000) % 60;

            console.log(test);
            var timerDiv = $('#timer');
            timerDiv.text(getTimeToDisplay());

            if (test < 0) {
                console.log("Finished countdown");
                timerDiv.text('00:00:00');
                stopTimer();
                soundEffect.play();
            }
        }, 100);
    }

    function stopTimer() {
        clearInterval(interval);
        $('#run-timer').text('Start');
        isCountdownSet = false;
        running = false;
        finished = true;
    }

    function reset() {
        stopTimer();
        $('#seconds').val(0);
        $('#minutes').val(0);
        $('#timer').text('00:00:00');
        countDownTimeInMillis = 0;
    }
</script>
</body>
</html>